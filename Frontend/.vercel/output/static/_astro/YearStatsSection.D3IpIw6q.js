import{j as s}from"./jsx-runtime.DobA4Wei.js";import{C as d,M as u,c as i}from"./COLORS.DQT3oG8g.js";import{r as l}from"./index.vg6u8O4B.js";const m=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];function h(r,t){return new d(r,{type:"line",data:{labels:m,datasets:t},options:{scales:{y:{beginAtZero:!0,grid:{display:!1}},x:{grid:{display:!1}}}}})}const p="http://localhost:3001";async function y(r){try{const e=await(await fetch(`${p}/stats/getByYear`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({year:r})})).json();if(!e.error)return e;throw new Error(e.error)}catch(t){throw console.error(t),t}}function b(r){const t={};for(const e of u)t[e.toLowerCase()]=Array(12).fill(0);for(let e of r){let o=new Date(e.date).getMonth();for(let a of e.material)t[a.name][o]+=a.quantity}return t}function w(r){const t=b(r);return u.map((e,o)=>{const a=e.toLowerCase();return{data:t[a],label:a.charAt(0).toUpperCase()+a.slice(1),backgroundColor:i[o],borderColor:i[o],fill:!1}})}function D(){const r=l.useRef(null),[t,e]=l.useState(!1);return l.useEffect(()=>{e(!1),(async()=>{const a=new Date().getFullYear(),n=await y(a);if(!(n&&n.length>1))return;const f=w(n);if(!r.current)return;const c=r.current.getContext("2d");c&&(h(c,f),setTimeout(()=>{e(!0)},500))})()},[]),s.jsxs("section",{className:"mt-12",children:[s.jsxs("h3",{className:"font-semibold text-xl text-center mb-4",children:["Ãšltimos datos de ",new Date().getFullYear()]}),s.jsx("div",{className:`w-full ${t?"block":"hidden"}`,children:s.jsx("canvas",{ref:r})})]})}export{D as default};
