import{j as e}from"./jsx-runtime.ozvemubn.js";import{r as d}from"./index.ERiRZYqk.js";import{g}from"./getTokenFromSession.BIEqYT4d.js";import{c as p}from"./auth.Bit6wUPJ.js";function j(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",fill:"currentColor",viewBox:"0 0 512 512",children:e.jsx("path",{d:"M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480V396.4c0-4 1.5-7.8 4.2-10.7L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"})})}const w="http://localhost:3001";async function y({content:n,forumId:r,token:s}){const l={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({content:n})};try{const a=await(await fetch(`${w}/forum/${r}/message`,l)).json();if(!a.error)return a;throw new Error(a.error)}catch(o){throw console.error("Error al crear mensaje:",o),o}}const b=({content:n,userName:r,self:s})=>{const l="p-2 rounded-3xl px-4 border",o=`${l} bg-ecologica-secondary text-white`,a=`${l} bg-gray-200 mt-5`;return e.jsxs("div",{className:`${s?"self-end":" self-start"} flex item-center`,children:[!s&&e.jsx("div",{className:"flex flex-col justify-center relative",children:e.jsx("p",{className:"text-xs text-center text-gray-700 w-20 absolute top-0 left-0",children:r})}),e.jsx("div",{className:`${s?o:a}`,children:e.jsx("p",{children:n})})]})},N="http://localhost:3001";async function v(n){try{const s=await(await fetch(`${N}/forum/${n}/getAllMessages`)).json();if(!s.error)return s;throw new Error(s.error)}catch(r){throw console.error(r),r}}function E({currentForum:n}){const[r,s]=d.useState(""),[l,o]=d.useState([]),[a,m]=d.useState(null),f=t=>{const c=t.target.value;s(c)},x=async t=>{t.preventDefault();const c=g();if(!c||!r)return;const i=await y({forumId:String(n.id),token:c,content:r});i.self=a?.user?i.userId===a?.user?.id:!1,o(h=>[...h,i]),s("")};return d.useEffect(()=>{const t=p();m(t),(async()=>{const h=(await v(String(n?.id))).map(u=>(u.self=t?.user?u.userId===t?.user?.id:!1,u));o(h)})()},[]),e.jsxs("section",{className:"flex-1 mt-6 min-h-[80vh] ",children:[e.jsxs("div",{className:"border-b border-b-gray-300 pb-3",children:[e.jsx("h3",{className:"font-bold",children:n?.title}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:n?.description})]}),e.jsxs("div",{className:"flex flex-col justify-between h-auto lg:h-[90%]",children:[e.jsx("div",{className:"flex flex-col gap-3 p-3 h-full max-h-[650px] overflow-y-scroll",children:l.length>0?l.map(t=>e.jsx(b,{content:t.content,userName:t.User.name,self:t.self},t.id)):e.jsx("p",{className:"font-semibold text-center text-sm",children:"Todavía no hay mensajes... ¡Sé el primero en escribir!"})}),a?e.jsx("form",{className:"mt-6",onSubmit:x,children:e.jsxs("label",{className:"w-full flex gap-2 bg-white px-2 items-center rounded-lg",children:[e.jsx("input",{onChange:f,value:r,className:"w-full py-3 pl-2 focus:outline-none",type:"text",id:"messageInput",placeholder:"Escribe un mensaje...",title:"Campo para escribir mensajes"}),e.jsx("button",{className:"w-8 flex justify-center items-center text-white bg-sky-400 rounded-full h-8",children:e.jsx(j,{})})]})}):e.jsx("div",{className:"w-full font-bold text-center bg-gray-200 p-4 rounded-lg",children:e.jsxs("p",{children:["¿Quieres participar en la conversación?",e.jsx("a",{className:"text-blue-500 hover:opacity-80",href:"/usuario/login",children:" ¡Inicia Sesión!"})]})})]})]})}export{E as default};
